<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgejo Game Dev Pipeline</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background: #f4f4f4;
        }

        h1,
        h2 {
            color: #2c3e50;
            color: green;
        }

        .section {
            display: none;
            padding: 15px;
            margin-bottom: 60px;
            border-radius: 5px;
            background-color: #fff;
            box-shadow: 1px 1px 8px rgba(0, 0, 0, 0.1);
        }

        .section.active {
            display: block;
        }

        input,
        button,
        textarea {
            width: 100%;
            margin-top: 10px;
            padding: 8px;
        }

        label {
            font-weight: bold;
            margin-top: 15px;
            display: block;
        }

        .script-box {
            height: 150px;
            font-family: monospace;
        }

        pre {
            background: #eee;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }

        .tabs {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            display: flex;
            background: #222;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            color: #fff;
            cursor: pointer;
            border-right: 1px solid #444;
            transition: background 0.3s;
        }

        .tab:last-child {
            border-right: none;
        }

        .tab:hover {
            background: #444;
        }

        .tab.active-tab {
            background: #005a9c;
        }
    </style>
</head>

<body>

    <h1><img src="https://i.postimg.cc/CKng8yk4/forgejo.png" style="width:30px;margin-right:6px">Forgejo Game Dev
        Pipeline</h1>

    <!-- STEP 1 -->
    <div class="section active" id="step1">
        <h2>Step 1 — Setup Forgejo on Azure</h2>
        <p>We use an automated script <code>create_vm_s_forgejo</code> to provision a 1TB Ubuntu VM, install Forgejo,
            Git LFS, and make it accessible on a public URL:</p>
        <pre>
# create_vm_s_forgejo
# - Creates 1TB Ubuntu VM on Azure
# - Installs Git, Git LFS
# - Downloads & installs Forgejo
# - Makes Forgejo accessible at https://forgejo.example.com
</pre>
        <p>After the VM is running, launch Forgejo:</p>
        <pre>
# Open https://forgejo.example.com
# Create admin username & password
# Log in to web UI
# Create your first user & repository
# Generate personal access token with read/write repo permissions
</pre>
    </div>

    <!-- STEP 2 -->
    <div class="section" id="step2">
        <h2>Step 2 — Adding Collaborators</h2>
        <ol>
            <li>Team members create Forgejo accounts at <strong>https://forgejo.example.com</strong></li>
            <li>Repo admin goes to <strong>Settings → Collaboration</strong></li>
            <li>Add collaborators with <strong>Write</strong> access</li>
            <li>Each collaborator generates a personal access token for Git operations</li>
        </ol>
    </div>

    <!-- STEP 3 -->
    <div class="section" id="step3">
        <h2>Step 3 — Setup Team Access</h2>
        <ol>
            <li>Each team member creates a Forgejo account.</li>
            <li>Admin adds them as collaborator:</li>
            <pre>
repo → Settings → Collaborators & Teams → Add Collaborator
</pre>
            <li>Set permission level: Read = pull, Write = push & pull</li>
            <li>Clone using personal token:
                <pre>git clone https://USERNAME:TOKEN@forgejo.win10dev.xyz/your-repo.git</pre>
            </li>
        </ol>
    </div>

    <!-- STEP 4 -->
    <div class="section" id="step4">
        <h2>Step 4 — Setup VSCode & Visual Studio 2022</h2>
        <ul>
            <li>VSCode Online — access via cloud terminal (e.g., <a
                    href="https://vscode.example.com">https://vscode.example.com</a>)</li>
            <li>Visual Studio 2022 — installed on Windows for compilation</li>
        </ul>
        <p>Both editors can be used simultaneously, but compilation happens in Visual Studio 2022.</p>
    </div>

    <!-- STEP 5 -->
    <div class="section" id="step5">
        <h2>Step 5 — Clone Scripts Generator</h2>
        <label for="forgejoUrl">Forgejo URL</label>
        <input type="text" id="forgejoUrl" placeholder="https://forgejo.example.com">

        <label for="username">Username</label>
        <input type="text" id="username" placeholder="username">

        <label for="token">Personal Access Token</label>
        <input type="text" id="token" placeholder="TOKEN">

        <label for="vscodeScript">VSCode Online (bash) Script</label>
        <textarea id="vscodeScript" class="script-box" readonly></textarea>
        <button onclick="downloadScript('vscode')">Download VSCode Script (.sh)</button>

        <label for="vsScript">Visual Studio 2022 (PowerShell) Script</label>
        <textarea id="vsScript" class="script-box" readonly></textarea>
        <button onclick="downloadScript('vs')">Download PowerShell Script (.ps1)</button>
    </div>

    <!-- STEP 6 -->
    <div class="section" id="step6">
        <h2>Step 6 — Enable Git LFS on Developer Machines</h2>
        <pre>
git lfs install
# Add common UE3 patterns to .gitattributes
*.uasset filter=lfs diff=lfs merge=lfs -text
*.umap   filter=lfs diff=lfs merge=lfs -text
*.upk    filter=lfs diff=lfs merge=lfs -text
# Commit & push
git add .gitattributes
git commit -m "Enable Git LFS tracking"
git push origin main
</pre>
    </div>

    <!-- STEP 7 -->
    <div class="section" id="step7">
        <h2>Step 7 — Setting up Webhooks</h2>
        <p>Forgejo supports webhooks to send repo updates to Discord, project management tools, or CI/CD pipelines:</p>
        <p>Configure via: <a href="https://forgejo.example.com/username/repo/settings/hooks" target="_blank">repo
                settings → Webhooks</a></p>
    </div>

    <!-- STEP 8 -->
    <div class="section" id="step8">
        <h2>Step 8 — Setup Forgejo Runner + IncrediBuild</h2>
        <ol>
            <li>Install Forgejo Runner on Windows 10 Azure instance.</li>
            <li>Ensure Visual Studio 2022 + IncrediBuild installed.</li>
            <li>Configure runner script:
                <pre>
cd C:\path\to\repo
git pull origin main
"C:\Program Files\Xoreax\IncrediBuild\BuildConsole.exe" /Project:"YourProject.sln" /Rebuild /Config:Release
pop3d.exe -game pop3d -console -map testmap.bsp
</pre>
            </li>
            <li>Optional: disable automatic builds with:
                <pre>
if exist .disable_build (
    echo "Automatic build disabled."
    exit /b 0
)
</pre>
            </li>
            <li>Invite team to OpenVPN for distributed compilation</li>
        </ol>
    </div>

    <!-- TABS -->
    <div class="tabs">
        <div class="tab active-tab" onclick="showStep(1)">Step 1</div>
        <div class="tab" onclick="showStep(2)">Step 2</div>
        <div class="tab" onclick="showStep(3)">Step 3</div>
        <div class="tab" onclick="showStep(4)">Step 4</div>
        <div class="tab" onclick="showStep(5)">Step 5</div>
        <div class="tab" onclick="showStep(6)">Step 6</div>
        <div class="tab" onclick="showStep(7)">Step 7</div>
        <div class="tab" onclick="showStep(8)">Step 8</div>
    </div>

    <script>
        // Tab navigation
        function showStep(step) {
            const sections = document.querySelectorAll('.section');
            const tabs = document.querySelectorAll('.tab');
            sections.forEach((s, i) => {
                s.classList.remove('active');
                tabs[i].classList.remove('active-tab');
            });
            document.getElementById('step' + step).classList.add('active');
            tabs[step - 1].classList.add('active-tab');
        }

        // Clone Script Generator
        function generateScripts() {
            const url = document.getElementById('forgejoUrl').value.trim();
            const user = document.getElementById('username').value.trim();
            const token = document.getElementById('token').value.trim();
            if (!url || !user || !token) return;

            const cleanUrl = url.replace(/^https?:\/\//, '');
            const repoName = cleanUrl.split('/').pop().replace(/\.git$/, '');
            const fullRepoUrl = `https://${token}@${cleanUrl}.git`;

            const vscodeScript = `#!/bin/bash
cd ~/projects
git clone ${fullRepoUrl}
cd ${repoName}
echo "Repository cloned into ~/projects/${repoName}"
git config --global credential.helper store`;

            const vsScript = `# PowerShell
D:
git clone https://${user}:${token}@${cleanUrl}.git D:\\${repoName}
cd D:\\${repoName}
Write-Host "Repository cloned into D:\\${repoName}"
git config --global credential.helper manager-core`;

            document.getElementById('vscodeScript').value = vscodeScript;
            document.getElementById('vsScript').value = vsScript;
        }

        function downloadScript(type) {
            let scriptContent, filename;
            if (type === 'vscode') {
                scriptContent = document.getElementById('vscodeScript').value;
                filename = 'clone_vscode.sh';
            } else {
                scriptContent = document.getElementById('vsScript').value;
                filename = 'clone_vs.ps1';
            }
            const blob = new Blob([scriptContent], { type: 'text/plain' });
            const link = document.createElement('a');
            link.download = filename;
            link.href = window.URL.createObjectURL(blob);
            link.click();
        }

        document.getElementById('forgejoUrl').addEventListener('input', generateScripts);
        document.getElementById('username').addEventListener('input', generateScripts);
        document.getElementById('token').addEventListener('input', generateScripts);
        generateScripts();
    </script>

</body>

</html>